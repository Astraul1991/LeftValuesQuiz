<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Risultati - Quiz Politico</title>
  <link rel="stylesheet" href="stile.css">
  <style>
    body {
      font-family: "Arial", sans-serif;
      color: white;
      background-color: #1a1a1a;
      padding: 2rem;
    }

    .result-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .bar {
      height: 30px;
      display: flex;
      border: 1px solid #666;
      background-color: #333;
      margin-top: 0.5rem;
      position: relative;
    }

    .bar-fill {
      height: 100%;
      display: inline-block;
    }

    .bar-text {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.2rem;
    }

    .label {
      font-weight: bold;
    }

    .left-icon,
    .right-icon {
      width: 30px;
      height: 30px;
      background-color: #ccc;
      display: inline-block;
      margin-right: 10px;
    }

    .bar-percent {
      position: absolute;
      width: 100%;
      top: 5px;
      text-align: center;
      font-size: 14px;
      color: #fff;
    }

    .back-button {
      margin-top: 2rem;
      display: inline-block;
      padding: 10px 20px;
      background-color: #aa0000;
      color: white;
      text-decoration: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div class="result-container">
    <h1>Risultati del tuo orientamento</h1>
    <div id="results"></div>
    <a href="quiz.html" class="back-button">Ricomincia il quiz</a>
  </div>

  <script>
    const axes = [
      { left: "Insurrezionalismo", right: "Riformismo" },
      { left: "Partitismo", right: "Sindacalismo" },
      { left: "Centralismo", right: "Decentralismo" },
      { left: "Autoritarismo", right: "Libertarismo" },
    ];

    const maxScores = [30, 15, 10]; // Alto, Medio, Basso

    const points = JSON.parse(localStorage.getItem('politicalQuizPoints')) || [];
    const levels = JSON.parse(localStorage.getItem('politicalQuizLevels')) || [];

    const axesCount = 4;
    const questionsPerAxis = 10;
    const resultsDiv = document.getElementById("results");

    for (let i = 0; i < axesCount; i++) {
      const start = i * questionsPerAxis;
      const end = start + questionsPerAxis;

      let totalLeft = 0;
      let totalRight = 0;
      let totalPossible = 0;

      for (let j = start; j < end; j++) {
        const answer = points[j];
        const level = levels[j];

        let value = 0;
        if (answer === 0) continue; // Nessuna risposta
        else if (answer === 1) value = level === "alto" ? 3 : level === "medio" ? 1.5 : 1;
        else if (answer === 2) value = level === "alto" ? 2 : level === "medio" ? 1 : 0.5;
        else if (answer === 3) value = level === "alto" ? 1 : level === "medio" ? 0.5 : 0.25;
        else continue; // altro tipo

        // Risposte da 1 a 3 = lato sinistro. Da 5 a 7 = lato destro.
        if (answer >= 1 && answer <= 3) totalLeft += value;
        else if (answer >= 5 && answer <= 7) totalRight += value;

        // Calcola massimo teorico possibile per quella domanda
        totalPossible += level === "alto" ? 3 : level === "medio" ? 1.5 : 1;
      }

      const leftPercent = Math.round((totalLeft / totalPossible) * 100);
      const rightPercent = 100 - leftPercent;

      const axis = axes[i];

      const barContainer = document.createElement("div");
      barContainer.classList.add("bar-block");

      const labelRow = document.createElement("div");
      labelRow.classList.add("bar-text");

      const leftLabel = document.createElement("div");
      leftLabel.classList.add("label");
      leftLabel.innerHTML = `<span class="left-icon"></span>${axis.left}`;

      const rightLabel = document.createElement("div");
      rightLabel.classList.add("label");
      rightLabel.innerHTML = `${axis.right}<span class="right-icon"></span>`;

      labelRow.appendChild(leftLabel);
      labelRow.appendChild(rightLabel);

      const bar = document.createElement("div");
      bar.classList.add("bar");

      const barFillLeft = document.createElement("div");
      barFillLeft.classList.add("bar-fill");
      barFillLeft.style.width = leftPercent + "%";
      barFillLeft.style.backgroundColor = "#c62828";

      const barFillRight = document.createElement("div");
      barFillRight.classList.add("bar-fill");
      barFillRight.style.width = rightPercent + "%";
      barFillRight.style.backgroundColor = "#6a1b9a";

      const barPercent = document.createElement("div");
      barPercent.classList.add("bar-percent");
      barPercent.innerText = `${leftPercent}% - ${rightPercent}%`;

      bar.appendChild(barFillLeft);
      bar.appendChild(barFillRight);
      bar.appendChild(barPercent);

      barContainer.appendChild(labelRow);
      barContainer.appendChild(bar);
      resultsDiv.appendChild(barContainer);
    }
  </script>
</body>
</html>
